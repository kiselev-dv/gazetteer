package me.osm.gazetter.test;

import static org.junit.Assert.assertEquals;

import java.util.List;

import me.osm.gazetter.striper.GeoJsonWriter;
import me.osm.gazetter.striper.Slicer;

import org.json.JSONObject;
import org.junit.Test;

import com.vividsolutions.jts.geom.LineString;
import com.vividsolutions.jts.io.ParseException;
import com.vividsolutions.jts.io.WKTReader;

public class LineSplitTest {
	
	@Test
	public void test1() {
		JSONObject obj = new JSONObject(Line1);
		
		LineString lineString = GeoJsonWriter.getLineStringGeometry(
				obj.getJSONObject("metainfo").getJSONObject("fullGeometry")
					.getJSONArray(GeoJsonWriter.COORDINATES));
		
		System.out.println(lineString);
		System.out.println();
		
		List<LineString> result = Slicer.stripe(lineString);
		
		
		for(LineString ls : result) {
			System.out.println(ls);
		}
		
		assertEquals(6, result.size());

		for(LineString ls : result) {
			System.out.println(Slicer.getFilePrefix(
					ls.getCentroid().getX(), 
					ls.getCentroid().getY()));
		}
		
		System.out.println();
	}

	@Test
	public void test2() throws ParseException {
		
		LineString lineString = (LineString) new WKTReader().read(Line2);
		
		System.out.println(lineString);
		System.out.println();
		
		List<LineString> result = Slicer.stripe(lineString);
		
		
		for(LineString ls : result) {
			System.out.println(ls);
		}
		
		for(LineString ls : result) {
			System.out.println(Slicer.getFilePrefix(
					ls.getCentroid().getX(), 
					ls.getCentroid().getY()));
		}
		
		System.out.println();
	}
	
	

	private static final String Line2="LINESTRING (38.5506327 53.96861, 38.5529292 53.9686214, 38.5535365 53.9685946, 38.5548529 53.9686151, 38.5582486 53.968535, 38.5702285 53.968341, 38.5716775 53.9683103, 38.5725063 53.968207, 38.5762254 53.9670381, 38.5773404 53.9668735, 38.6126518 53.9672075, 38.6146187 53.9671514, 38.6171249 53.966885, 38.6184744 53.966721, 38.6197061 53.9666671, 38.6210813 53.9667179, 38.6219543 53.9668606, 38.6226661 53.9670932, 38.6233384 53.9674306, 38.6237734 53.9679423, 38.6238584 53.9684562, 38.6238323 53.9700544, 38.6239909 53.9705941, 38.6244605 53.9710408, 38.6261115 53.9716001, 38.6297645 53.9725596, 38.6307905 53.9727452, 38.6641873 53.9743211, 38.6654245 53.9744204, 38.6682677 53.9752079, 38.6895786 53.9817656, 38.6917166 53.9832246, 38.6925792 53.9835161, 38.6942529 53.9811931, 38.6956799 53.9799439, 38.6976467 53.9793428, 38.7080167 53.9758128, 38.7154467 53.9737931, 38.7169541 53.9734606, 38.7316987 53.9702025, 38.736797 53.9683117, 38.7406659 53.9681981, 38.744951 53.9674092, 38.7474508 53.9670848, 38.7531135 53.9669763, 38.7672957 53.9669402, 38.7721451 53.9665463, 38.7744746 53.9662315, 38.7771396 53.9650576, 38.7786709 53.9648035, 38.7812453 53.9644067, 38.7838207 53.9640966, 38.785709 53.9631877, 38.7938358 53.9541751, 38.7951504 53.9526835, 38.7967841 53.9519162, 38.799947 53.9515361, 38.8035583 53.9492581, 38.8061079 53.9466031, 38.8068713 53.9458329, 38.807582 53.9452326, 38.8104655 53.9429879, 38.8124233 53.9414638, 38.8129474 53.9410588, 38.8133145 53.9406972, 38.8127019 53.9404229, 38.805375 53.9373156, 38.7982398 53.9343389, 38.7965734 53.9335955, 38.7951255 53.9328595, 38.7932388 53.931857, 38.7924626 53.9314311, 38.7921375 53.9312232, 38.7918587 53.9309799, 38.791555 53.9305828, 38.7913466 53.9302417, 38.7910305 53.9296458, 38.7894714 53.9266481, 38.7892895 53.9262975, 38.7892196 53.9261402, 38.7891846 53.9259799, 38.7892012 53.9258237, 38.7896142 53.9246035, 38.7898015 53.9240315, 38.7900135 53.9234143, 38.7901815 53.9229245)";
	
	private static final String Line1="{\n"+
			" \"id\": \"hghway-3399067535-w4406162\",\n"+
			" \"ftype\": \"hghway\",\n"+
			" \"timestamp\": \"2014-04-04T17:31:38.904Z\",\n"+
			" \"properties\": {\n"+
			" \"ref\": \"11\u0420-001\",\n"+
			" \"surface\": \"gravel\",\n"+
			" \"highway\": \"primary\",\n"+
			" \"maxspeed:practical\": \"60\",\n"+
			" \"maxspeed\": \"RU:rural\"\n"+
			" },\n"+
			" \"type\": \"Feature\",\n"+
			" \"metainfo\": {\n"+
			" \"id\": 4406162,\n"+
			" \"type\": \"way\",\n"+
			" \"fullGeometry\": {\n"+
			" \"type\": \"LineString\",\n"+
			" \"coordinates\": [\n"+
			" [40.33671250, 63.06286500],\n"+
			" [40.33772900, 63.06282100],\n"+
			" [40.33988370, 63.06277830],\n"+
			" [40.34218330, 63.06284700],\n"+
			" [40.34289270, 63.06295090],\n"+
			" [40.34345000, 63.06309130],\n"+
			" [40.34642810, 63.06416610],\n"+
			" [40.34797410, 63.06462680],\n"+
			" [40.35076480, 63.06525940],\n"+
			" [40.35219030, 63.06568450],\n"+
			" [40.35347470, 63.06613700],\n"+
			" [40.35470570, 63.06674200],\n"+
			" [40.35581820, 63.06776950],\n"+
			" [40.35614550, 63.06845040],\n"+
			" [40.35607370, 63.07242380],\n"+
			" [40.35501440, 63.07486630],\n"+
			" [40.35435840, 63.07582140],\n"+
			" [40.35296290, 63.07724630],\n"+
			" [40.35086310, 63.07913850],\n"+
			" [40.34931820, 63.08056600],\n"+
			" [40.34780260, 63.08197120],\n"+
			" [40.34694480, 63.08284770],\n"+
			" [40.34654010, 63.08348860],\n"+
			" [40.34646550, 63.08382840],\n"+
			" [40.34643500, 63.08397200],\n"+
			" [40.34649250, 63.08435760],\n"+
			" [40.34728060, 63.08590210],\n"+
			" [40.34777340, 63.08771330],\n"+
			" [40.34807500, 63.08810800],\n"+
			" [40.34849890, 63.08845070],\n"+
			" [40.34925110, 63.08880700],\n"+
			" [40.35208730, 63.08991380],\n"+
			" [40.35801520, 63.09215410],\n"+
			" [40.36041020, 63.09293990],\n"+
			" [40.37886000, 63.09775550],\n"+
			" [40.38122970, 63.09837730],\n"+
			" [40.38294920, 63.09901750],\n"+
			" [40.38561630, 63.10013120],\n"+
			" [40.40643050, 63.10973990],\n"+
			" [40.42623640, 63.11882260],\n"+
			" [40.43225890, 63.12130590],\n"+
			" [40.43597790, 63.12278460],\n"+
			" [40.49507270, 63.14645160],\n"+
			" [40.50507350, 63.15045500],\n"+
			" [40.50670640, 63.15107230],\n"+
			" [40.50828070, 63.15162340],\n"+
			" [40.51150130, 63.15246740],\n"+
			" [40.51421800, 63.15316690],\n"+
			" [40.51690970, 63.15383570],\n"+
			" [40.51851920, 63.15429700],\n"+
			" [40.52012780, 63.15482120],\n"+
			" [40.53343510, 63.16086520],\n"+
			" [40.53501640, 63.16171120],\n"+
			" [40.53674750, 63.16276120],\n"+
			" [40.53884220, 63.16405330],\n"+
			" [40.54115510, 63.16544620],\n"+
			" [40.54294440, 63.16654870],\n"+
			" [40.54352940, 63.16730920],\n"+
			" [40.54401920, 63.16852170],\n"+
			" [40.54438710, 63.16977260],\n"+
			" [40.54974770, 63.18638520],\n"+
			" [40.55137250, 63.19139860],\n"+
			" [40.55356620, 63.19816610],\n"+
			" [40.55513270, 63.20299770],\n"+
			" [40.55544870, 63.20385300],\n"+
			" [40.55597340, 63.20444830],\n"+
			" [40.55705520, 63.20518140],\n"+
			" [40.55799770, 63.20581550],\n"+
			" [40.56577340, 63.21101380],\n"+
			" [40.57361690, 63.21611730],\n"+
			" [40.57496240, 63.21678890],\n"+
			" [40.57669790, 63.21755410],\n"+
			" [40.57809030, 63.21803260],\n"+
			" [40.57955830, 63.21841540],\n"+
			" [40.58193100, 63.21889700],\n"+
			" [40.58376710, 63.21913480],\n"+
			" [40.58651200, 63.21938250],\n"+
			" [40.60067480, 63.22043810],\n"+
			" [40.61040830, 63.22117480],\n"+
			" [40.61194660, 63.22136900],\n"+
			" [40.61372490, 63.22167880],\n"+
			" [40.61517640, 63.22209480],\n"+
			" [40.61623910, 63.22250690],\n"+
			" [40.62718940, 63.22776520],\n"+
			" [40.63865370, 63.23313200],\n"+
			" [40.63958530, 63.23365860],\n"+
			" [40.64016730, 63.23410950],\n"+
			" [40.64068880, 63.23460090],\n"+
			" [40.64144730, 63.23566050],\n"+
			" [40.64391070, 63.24259750],\n"+
			" [40.64502180, 63.24572580],\n"+
			" [40.64747140, 63.25239420],\n"+
			" [40.64835180, 63.25479040],\n"+
			" [40.64915840, 63.25687910],\n"+
			" [40.64924610, 63.25737710],\n"+
			" [40.64914750, 63.25794980],\n"+
			" [40.64896400, 63.25833460],\n"+
			" [40.64869020, 63.25858720],\n"+
			" [40.64837040, 63.25875430],\n"+
			" [40.64795140, 63.25886550],\n"+
			" [40.64731900, 63.25895750],\n"+
			" [40.64659340, 63.25903560],\n"+
			" [40.64456340, 63.25925420],\n"+
			" [40.63437560, 63.26019940],\n"+
			" [40.62414750, 63.26112100],\n"+
			" [40.61354050, 63.26211000],\n"+
			" [40.60118430, 63.26326200],\n"+
			" [40.59113870, 63.26421510],\n"+
			" [40.58436330, 63.26482130],\n"+
			" [40.57819000, 63.26537590],\n"+
			" [40.57537160, 63.26563410],\n"+
			" [40.57462040, 63.26574700],\n"+
			" [40.57395960, 63.26592730],\n"+
			" [40.57361570, 63.26610060],\n"+
			" [40.57331380, 63.26637440],\n"+
			" [40.57306380, 63.26669500],\n"+
			" [40.57225060, 63.26831910],\n"+
			" [40.57165370, 63.26947230],\n"+
			" [40.57142370, 63.26993120]\n"+
			" ]\n"+
			" }\n"+
			" },\n"+
			" \"geometry\": {\n"+
			" \"type\": \"LineString\",\n"+
			" \"coordinates\": [\n"+
			" [40.60000000, 63.22038780],\n"+
			" [40.60000000, 63.22038780]\n"+
			" ]\n"+
			" }\n"+
			"}";
	
}
